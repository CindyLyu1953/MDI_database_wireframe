<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Details - Questionnaire Database Platform</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/article.css') }}">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>Questionnaire Database Platform</h1>
                <span class="tagline">Academic Research Tool</span>
            </div>
            <nav class="nav">
                <a href="{{ url_for('index') }}" class="nav-link">Home</a>
                <a href="{{ url_for('search') }}" class="nav-link">Search</a>
                <a href="{{ url_for('compare') }}" class="nav-link">Compare</a>
                <a href="{{ url_for('profile') }}" class="nav-link">Profile</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Article Header Information -->
            <section class="article-header">
                <div class="article-meta">
                    <div class="article-journal">{{ paper.journal }}</div>
                    <div class="article-year">{{ paper.year }}</div>
                    <div class="article-citations">Citations: {{ paper.citations }}</div>
                </div>
                
                <h1 class="article-title">{{ paper.title }}</h1>
                
                <div class="article-authors">
                    <strong>Authors:</strong> {{ paper.authors|join(', ') }}
                </div>
                
                    <div class="article-actions">
                        <button class="btn btn-outline" onclick="addToCompare()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h4m0-7v7m0-7h10a2 2 0 0 1 2 2v3c0 1.1-.9 2-2 2H9m0-7V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
                            </svg>
                            Add to Compare
                        </button>
                        <button class="btn btn-outline" onclick="exportArticle()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export
                        </button>
                    </div>
            </section>

            <!-- Article Content -->
            <section class="article-content">
                <div class="content-grid">
                    <!-- Main Content on Left -->
                    <div class="content-main">
                        <!-- Abstract -->
                        <div class="content-section">
                            <h2 class="section-title">Abstract</h2>
                            <div class="feature-content">
                                <div class="feature-summary">
                                    <p>{{ paper.abstract }}</p>
                                </div>
                                {% if paper.abstract_verbatim and paper.abstract_verbatim != 'NOT SPECIFIED' %}
                                <button class="btn btn-outline btn-sm" onclick="toggleFullText('abstract')">
                                    <span class="btn-text">View Full Abstract</span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6,9 12,15 18,9"></polyline>
                                    </svg>
                                </button>
                                <div class="feature-full-text hidden" id="abstract-full">
                                    <p>{{ paper.abstract_verbatim }}</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>


                        <!-- Extracted Features -->
                        <div class="content-section">
                            <div class="features-container">
                                {% for feature_name, feature_value in paper.extracted_features.items() %}
                                    {% if feature_value and feature_value != 'NOT SPECIFIED' and not feature_name.endswith('_verbatim') %}
                                        <div class="feature-item">
                                            <h3 class="feature-title">{{ feature_name.replace('_', ' ').title() }}</h3>
                                            <div class="feature-content">
                                                <div class="feature-summary">
                                                    <p>{{ feature_value }}</p>
                                                </div>
                                                
                                                {% set verbatim_key = feature_name + '_verbatim' %}
                                                {% if verbatim_key in paper.extracted_features and paper.extracted_features[verbatim_key] and paper.extracted_features[verbatim_key] != 'NOT SPECIFIED' %}
                                                    <button class="btn btn-outline btn-sm" onclick="toggleFullText('{{ feature_name }}')">
                                                        <span class="btn-text">View Full</span>
                                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="6,9 12,15 18,9"></polyline>
                                                        </svg>
                                                    </button>
                                                    <div class="feature-full-text hidden" id="{{ feature_name }}-full">
                                                        <p>{{ paper.extracted_features[verbatim_key] }}</p>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar on Right -->
                    <div class="content-sidebar">
                        <div class="sidebar-section">
                            <h3 class="sidebar-title">Study Information</h3>
                            <div class="sidebar-content">
                                <div class="info-item">
                                    <span class="info-label">Journal:</span>
                                    <span class="info-value">{{ paper.journal }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Year:</span>
                                    <span class="info-value">{{ paper.year }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Sample Size:</span>
                                    <span class="info-value">{{ "{:,}".format(paper.sample_size) }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Countries:</span>
                                    <span class="info-value">{{ paper.countries|join(', ') }}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Methodology:</span>
                                    <span class="info-value">{{ paper.methodology }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>About Us</h4>
                    <p>To provide efficient tools and platforms for academic research</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="{{ url_for('search') }}">Search Research</a>
                    <a href="{{ url_for('compare') }}">Compare Features</a>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p>support@questionnaire-platform.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Questionnaire Database Platform. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Track article view on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateUserStats('articlesViewed');
            
            // Check content length and hide unnecessary View Full buttons
            setTimeout(checkContentLength, 100);
        });

        function updateUserStats(action) {
            let stats = JSON.parse(localStorage.getItem('userStats') || '{}');
            if (!stats.searches) stats.searches = 0;
            if (!stats.comparisons) stats.comparisons = 0;
            if (!stats.articlesViewed) stats.articlesViewed = 0;
            
            if (action === 'searches') {
                stats.searches += 1;
            } else if (action === 'comparisons') {
                stats.comparisons += 1;
            } else if (action === 'articlesViewed') {
                stats.articlesViewed += 1;
            }
            
            localStorage.setItem('userStats', JSON.stringify(stats));
        }

        function toggleFullText(featureId) {
            const fullTextElement = document.getElementById(featureId + '-full');
            const button = event.target.closest('button');
            
            if (fullTextElement.classList.contains('hidden')) {
                fullTextElement.classList.remove('hidden');
                button.querySelector('.btn-text').textContent = 'Hide Full';
            } else {
                fullTextElement.classList.add('hidden');
                button.querySelector('.btn-text').textContent = 'View Full';
            }
        }

        function checkContentLength() {
            // Check all feature content and hide View Full buttons for short content
            document.querySelectorAll('.feature-content').forEach(content => {
                const summary = content.querySelector('.feature-summary');
                const fullText = content.querySelector('.feature-full-text');
                const button = content.querySelector('button[onclick*="toggleFullText"]');
                
                if (summary && fullText && button) {
                    const summaryText = summary.textContent.trim();
                    const fullTextContent = fullText.textContent.trim();
                    
                    // Hide button if content is short (less than 100 characters difference)
                    if (fullTextContent.length - summaryText.length < 100) {
                        button.style.display = 'none';
                    }
                }
            });
        }
        
        function addToCompare() {
            console.log('Adding to compare');
        }
        
        function toggleFavorite() {
            console.log('Toggling favorite');
        }
        
        function exportArticle() {
            console.log('Exporting article');
        }
    </script>
</body>
</html>
