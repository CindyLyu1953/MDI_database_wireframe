{% extends "base.html" %}

{% block title %}Search Results - Questionnaire Database Platform{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- Search Bar -->
    <section class="search-section">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search keywords, authors, journals..." class="search-input" value="{{ query }}">
            <button class="search-btn" onclick="performSearch()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                Search
            </button>
        </div>
    </section>

    <!-- Search Results -->
    <section class="results-section">
        <div class="results-header">
            <h2 class="results-title">Search Results</h2>
            <div class="results-count">
                <span>Found {{ results|length }} relevant articles</span>
            </div>
        </div>

        <div class="results-list">
            {% if results %}
                {% for paper in results %}
                <article class="result-item">
                    <div class="result-header">
                        <h3 class="result-title">
                            <a href="{{ url_for('article', paper_id=paper.id) }}">{{ paper.title }}</a>
                        </h3>
                        <div class="result-actions">
                            <button class="btn btn-outline btn-sm" onclick="addToCompare('{{ paper.id }}')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 11H5a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h4m0-7v7m0-7h10a2 2 0 0 1 2 2v3c0 1.1-.9 2-2 2H9m0-7V9a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                Compare
                            </button>
                        </div>
                    </div>
                    
                    <div class="result-meta">
                        <div class="result-authors">
                            <strong>Authors:</strong> {{ paper.authors|join(', ') }}
                        </div>
                        <div class="result-journal">
                            <strong>Journal:</strong> {{ paper.journal }}, {{ paper.year }}
                        </div>
                        <div class="result-citations">
                            <strong>Citations:</strong> {{ paper.citations }} times
                        </div>
                    </div>

                    <div class="result-abstract">
                        <p>{{ paper.abstract }}</p>
                    </div>

                    <div class="result-footer">
                        <a href="{{ url_for('article', paper_id=paper.id) }}" class="btn btn-primary">View Details</a>
                    </div>
                </article>
                {% endfor %}
            {% else %}
                <div class="no-results">
                    <h3>No results found</h3>
                    <p>Try adjusting your search criteria or browse all articles.</p>
                    <a href="{{ url_for('search') }}" class="btn btn-primary">Browse All Articles</a>
                </div>
            {% endif %}
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button class="pagination-btn" disabled>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15,18 9,12 15,6"></polyline>
                </svg>
                Previous
            </button>
            <div class="pagination-pages">
                <button class="pagination-page active">1</button>
                <button class="pagination-page">2</button>
                <button class="pagination-page">3</button>
            </div>
            <button class="pagination-btn">
                Next
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9,18 15,12 9,6"></polyline>
                </svg>
            </button>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
    function performSearch() {
        const searchInput = document.getElementById('searchInput');
        const query = searchInput.value.trim();
        if (query) {
            window.location.href = "{{ url_for('search') }}?q=" + encodeURIComponent(query);
        }
    }

    function addToCompare(paperId) {
        // Get current comparison list from localStorage
        let comparisonIds = JSON.parse(localStorage.getItem('comparisonIds') || '[]');
        
        // Add new paper if not already in list
        if (!comparisonIds.includes(paperId)) {
            comparisonIds.push(paperId);
            
            // Limit to maximum 3 papers for comparison
            if (comparisonIds.length > 3) {
                comparisonIds = comparisonIds.slice(-3);
                alert('Maximum 3 papers can be compared. The oldest paper has been removed.');
            }
            
            // Save to localStorage
            localStorage.setItem('comparisonIds', JSON.stringify(comparisonIds));
            
            // Update button text to show it's been added
            event.target.textContent = 'Added';
            event.target.style.backgroundColor = '#28a745';
            
            // Show notification
            showNotification(`Added to comparison (${comparisonIds.length}/3)`);
        } else {
            alert('This paper is already in the comparison list.');
        }
    }
    
    function showNotification(message) {
        // Create notification element
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 14px;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        // Remove after 3 seconds
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 3000);
    }
</script>
{% endblock %}