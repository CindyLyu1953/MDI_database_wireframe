<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        .error { background: #ffcccc; }
        .success { background: #ccffcc; }
    </style>
</head>
<body>
    <h1>Debug Search Functionality</h1>
    
    <div id="debugOutput" class="debug">
        Loading...
    </div>

    <script src="js/csv-loader.js"></script>
    <script src="js/data-loader.js"></script>
    <script>
        async function debugSearch() {
            const output = document.getElementById('debugOutput');
            let log = '';
            
            try {
                log += '=== DEBUGGING SEARCH FUNCTIONALITY ===\n\n';
                
                // Step 1: Check if CSV loader exists
                log += '1. Checking CSV loader...\n';
                if (window.csvDataLoader) {
                    log += '   ✓ CSV loader exists\n';
                } else {
                    log += '   ✗ CSV loader NOT found\n';
                    output.className = 'debug error';
                    output.textContent = log;
                    return;
                }
                
                // Step 2: Load CSV data
                log += '\n2. Loading CSV data...\n';
                const csvData = await window.csvDataLoader.loadCSVData();
                log += `   ✓ CSV loaded: ${csvData.papers.length} papers\n`;
                
                // Step 3: Check if data loader exists
                log += '\n3. Checking data loader...\n';
                if (window.dataLoader) {
                    log += '   ✓ Data loader exists\n';
                } else {
                    log += '   ✗ Data loader NOT found\n';
                    output.className = 'debug error';
                    output.textContent = log;
                    return;
                }
                
                // Step 4: Load papers into data loader
                log += '\n4. Loading papers into data loader...\n';
                await window.dataLoader.loadPapers();
                const papers = window.dataLoader.getAllPapers();
                log += `   ✓ Papers loaded: ${papers.length} papers\n`;
                
                // Step 5: Check paper structure
                log += '\n5. Checking paper structure...\n';
                if (papers.length > 0) {
                    const firstPaper = papers[0];
                    log += `   First paper title: "${firstPaper.title}"\n`;
                    log += `   First paper abstract: "${firstPaper.abstract.substring(0, 100)}..."\n`;
                    log += `   First paper authors: [${firstPaper.authors.join(', ')}]\n`;
                    log += `   First paper journal: "${firstPaper.journal}"\n`;
                }
                
                // Step 6: Test search for "online"
                log += '\n6. Testing search for "online"...\n';
                const searchResults = window.dataLoader.searchPapers('online');
                log += `   Search results: ${searchResults.length} papers found\n`;
                
                if (searchResults.length > 0) {
                    log += '   Found papers:\n';
                    searchResults.forEach((paper, index) => {
                        log += `     ${index + 1}. "${paper.title}"\n`;
                    });
                } else {
                    log += '   ✗ No papers found for "online"\n';
                    
                    // Debug: Check if "online" exists in any paper
                    log += '\n   Debugging: Checking if "online" exists in papers...\n';
                    papers.forEach((paper, index) => {
                        const searchText = [
                            paper.title,
                            paper.abstract,
                            paper.authors.join(' '),
                            paper.journal
                        ].join(' ').toLowerCase();
                        
                        if (searchText.includes('online')) {
                            log += `     Paper ${index + 1} contains "online": "${paper.title}"\n`;
                        }
                    });
                }
                
                // Step 7: Test search for "social"
                log += '\n7. Testing search for "social"...\n';
                const socialResults = window.dataLoader.searchPapers('social');
                log += `   Search results: ${socialResults.length} papers found\n`;
                
                log += '\n=== DEBUG COMPLETE ===\n';
                output.className = 'debug success';
                
            } catch (error) {
                log += `\n✗ ERROR: ${error.message}\n`;
                log += `Stack trace: ${error.stack}\n`;
                output.className = 'debug error';
            }
            
            output.textContent = log;
        }
        
        // Run debug when page loads
        document.addEventListener('DOMContentLoaded', debugSearch);
    </script>
</body>
</html>
